# Code Review ‚Äì 06 Tools: Navigace a spr√°va str√°nek (MVP)

Datum: 2025-10-11

## Co bylo provedeno

Implementov√°ny z√°kladn√≠ navigaƒçn√≠ n√°stroje pro MCP server s paritou n√°zv≈Ø a funkc√≠ z Chrome DevTools MCP.

### Dotƒçen√© ƒç√°sti

- `src/tools/pages.ts` - Implementace handler funkc√≠ pro v≈°echny page tools
- `src/McpContext.ts` - P≈ôid√°n√≠ metod `createNewPage()` a `closePage()`
- `src/firefox/devtools.ts` - P≈ôid√°n√≠ metod `createNewTab()` a `closeTab()`
- `src/firefox/rdp-client.ts` - Implementace RDP vol√°n√≠ `openNewTab()` a `closeTab()`

### Implementovan√© tools

1. **list_pages** - Zobraz√≠ seznam v≈°ech otev≈ôen√Ωch str√°nek s indexy, tituly a URL
   - Zv√Ωrazn√≠ vybranou str√°nku pomoc√≠ üëâ
   - Form√°tovan√Ω v√Ωstup s p≈ôehledn√Ωm seznamem

2. **select_page** - Vybere str√°nku jako aktivn√≠ kontext pro dal≈°√≠ operace
   - Validace indexu str√°nky
   - Automatick√© p≈ôipojen√≠ k tabu p≈ôes RDP attach

3. **new_page** - Vytvo≈ô√≠ novou str√°nku a naviguje na zadanou URL
   - Vytvo≈ôen√≠ nov√©ho tabu p≈ôes RDP `getTab` s `outerWindowID: 0`
   - Automatick√° navigace na URL
   - Automatick√Ω v√Ωbƒõr novƒõ vytvo≈ôen√© str√°nky
   - Vrac√≠ index nov√© str√°nky

4. **navigate_page** - Naviguje aktu√°lnƒõ vybranou str√°nku na novou URL
   - Validace vstupn√≠ URL
   - Refresh tab info po navigaci
   - Zobraz√≠ p≈ôedchoz√≠ i novou URL

5. **close_page** - Zav≈ôe str√°nku podle indexu
   - Validace existence str√°nky
   - RDP vol√°n√≠ `close` na tab actor
   - Automatick√Ω v√Ωbƒõr jin√© str√°nky pokud je zav≈ôena vybran√°
   - Bezpeƒçn√© o≈°et≈ôen√≠ ji≈æ zav≈ôen√Ωch tab≈Ø

## Rozhodnut√≠ a dopady

### Naming a API design
- Dr≈æeli jsme se n√°zv≈Ø z Chrome DevTools MCP (`list_pages`, `new_page`, `navigate_page`, atd.)
- Tool parametry jsou kompatibiln√≠: `url`, `pageIdx`
- Response form√°t pou≈æ√≠v√° emoji indik√°tory (üëâ, ‚úÖ) pro lep≈°√≠ UX

### RDP implementace
- Vytv√°≈ôen√≠ nov√©ho tabu: pou≈æit `getTab` s `outerWindowID: 0` (standardn√≠ RDP p≈ô√≠stup)
- Zav√≠r√°n√≠ tabu: pou≈æit `close` request na tab actor
- Error handling: o≈°et≈ôen√≠ p≈ô√≠pad≈Ø kdy je tab ji≈æ zav≈ôen√Ω

### Index management
- Po zav≈ôen√≠ tabu se automaticky vybere jin√Ω (p≈ôedchoz√≠ nebo prvn√≠ dostupn√Ω)
- Indexy se p≈ôepoƒç√≠t√°vaj√≠ po ka≈æd√© zmƒõnƒõ (refresh tabs)

### Zn√°m√° omezen√≠
- **Firefox RDP omezen√≠**: `getTab` s `outerWindowID: 0` m≈Ø≈æe nefungovat na v≈°ech verz√≠ch Firefoxu
  - Alternativn√≠ p≈ô√≠stup bude mo≈æn√° pot≈ôeba (pou≈æ√≠t existuj√≠c√≠ tab nebo jin√© RDP API)
- ≈Ω√°dn√° podpora pro `navigate_page_history` (back/forward) - Firefox RDP to p≈ô√≠mo nepodporuje
- Timeout parametry nejsou zat√≠m implementov√°ny pro `new_page` a `navigate_page`

## Reference

- `old/mcp_dev_tool_chrome/src/tools/pages.ts` - vzor pro API design a naming
- `old/mcp_gsheet` - vzor pro projektovou strukturu a error handling
- Firefox Remote Debugging Protocol dokumentace

## Dal≈°√≠ kroky

### Bezprost≈ôednƒõ n√°sleduj√≠c√≠ √∫kol
- **Task 07**: Tools: Debug a screenshoty (MVP)
  - `take_screenshot` - ji≈æ m√° boilerplate, pot≈ôebuje implementaci
  - `take_snapshot` - ji≈æ m√° boilerplate, pot≈ôebuje implementaci

### Mo≈æn√° vylep≈°en√≠ task 06 (pro budoucnost)
- Implementovat timeout parametry pro navigaci
- P≈ôidat support pro `navigate_page_history` (back/forward) pokud Firefox RDP umo≈æn√≠
- P≈ôidat validaci URL form√°tu p≈ôed navigac√≠
- Optimalizovat tab refreshing (nap≈ô. partial refresh m√≠sto full listTabs)

### Testing
- Po dokonƒçen√≠ task 07-09 vytvo≈ôit integration testy (task 10)
- Testovat edge cases:
  - Zav≈ôen√≠ posledn√≠ str√°nky
  - Vytv√°≈ôen√≠ v√≠ce str√°nek najednou
  - Navigace na neplatn√© URL

## Pozn√°mky k implementaci

### TypeScript type safety
- V≈°echny RDP response typy jsou bezpeƒçnƒõ otypovan√© s optional chaining
- Error handling m√° spr√°vn√© error typy (RdpError)

### Code quality
- ESLint: ‚úÖ Pro≈°lo bez chyb
- TypeScript: ‚úÖ Pro≈°lo typecheck bez chyb
- Form√°tov√°n√≠: ‚úÖ Prettier applied

### Testing v√Ωstupy
Manu√°ln√≠ testov√°n√≠ bude provedeno v task 10, ale z√°kladn√≠ kontroly:
- V≈°echny tools jsou registrovan√© v `src/index.ts`
- V≈°echny tools jsou exportovan√© z `src/tools/index.ts`
- Response form√°t je konzistentn√≠ (successResponse/errorResponse)
