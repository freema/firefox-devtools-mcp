# Code Review – 01 Projektový scaffold

Datum: 2025-10-11

## Co bylo provedeno

- Vytvořen `package.json` s kompletními skripty a závislostmi
- Konfigurace TypeScript, tsup, ESLint, Prettier, vitest
- Aktualizace `.gitignore` a vytvoření `.prettierignore`
- Instalace všech závislostí (357 balíčků)
- Vytvoření základní struktury adresářů (`src/`, `tests/`, `scripts/`)
- Minimální placeholder `src/index.ts` s Node.js version check
- Otestován build proces (`npm run build`) - ✅
- Otestován check proces (`npm run lint:fix && npm run typecheck`) - ✅

## Rozhodnutí a dopady

### Package.json

**Scripts**:
- `dev` - tsx watch mode pro development
- `build` - tsup bundling
- `start` - spuštění buildu
- `setup` - konfigurace MCP klientů (připraveno pro task 03)
- `check` - lint:fix + typecheck (podle požadavku task README)
- `inspector` / `inspector:dev` - MCP Inspector debugging
- `test` / `test:run` / `test:coverage` / `test:watch` / `test:ui` - vitest

**Dependencies**:
- `@modelcontextprotocol/sdk` ^1.17.1 - MCP SDK
- `zod` ^3.22.4 - Schema validation
- (RDP backend knihovny přijdou v pozdějších taskcích)

**Dev Dependencies**:
- TypeScript ^5.3.3
- tsup ^8.0.0 - Fast bundler
- ESLint ^8.57.1 + TypeScript plugin
- Prettier ^3.5.3
- vitest ^3.1.4 + UI + coverage
- tsx ^4.7.0 - TypeScript executor
- dotenv ^17.2.1

**Engines**: Node.js >=18.0.0 (vývoj na Node 22, podpora 18+20)

### TypeScript konfigurace

**Strict mode zapnut**:
- `strict: true`
- `noUnusedLocals: true`
- `noUnusedParameters: true`
- `noImplicitReturns: true`
- `noUncheckedIndexedAccess: true`
- `exactOptionalPropertyTypes: true`
- `useUnknownInCatchVariables: true`

Důvod: Maximální type safety, prevence běžných chyb

**Target**: ES2022, ESNext modules

### Tsup konfigurace

- **Format**: ESM only (module type: "module")
- **Target**: node18
- **Bundle**: true (všechny dependencies do jednoho souboru)
- **noExternal**: MCP SDK, zod, dotenv (bundle do výstupu)
- **External**: (žádné prozatím, Firefox RDP dependencies přijdou později)

### ESLint konfigurace

Přejata z `old/mcp_gsheet` s následujícími pravidly:
- Prettier integrace (`prettier/prettier: error`)
- TypeScript recommended + requiring-type-checking
- Vypnuté strict rules pro `any` (flexibilita při práci s RDP)
- Error na floating promises, misused promises
- Warning na no-console (allow error, warn)

### Vitest konfigurace

- **Coverage thresholds**: 70% (mírnější než 80% v mcp_gsheet, realistické pro MVP)
- **Setup file**: `tests/setup.ts`
- **Alias**: `@` -> `./src`
- **Provider**: v8

### .gitignore rozšíření

Přidáno:
- `dist/`, `build/` - Build output
- `.vscode/`, `.idea/` - IDE
- `.DS_Store`, `Thumbs.db` - OS
- `.tmp/`, `.temp/` - Temporary files
- `.task/` - Task runner
- Docker artifacts

## Známá omezení a technické dluhy

1. **ESLint 8 deprecated**: npm warnings ukazují, že ESLint 8 není podporován
   - Řešení: Update na ESLint 9 v budoucí iteraci
   - Pro MVP je ESLint 8 dostačující (kompatibilní s mcp_gsheet)

2. **Placeholder src/index.ts**: Pouze validace Node verze a placeholder log
   - Plná implementace MCP serveru přijde v task 02

3. **Žádné testy**: Setup připraven, ale žádné testy napsané
   - Testy přijdou v task 10

4. **Setup script chybí**: `npm run setup` volá neexistující skript
   - Vytvoření v task 03

## Reference

### Přejato z mcp_gsheet
- `old/mcp_gsheet/package.json` - Scripts, dependencies, structure
- `old/mcp_gsheet/tsconfig.json` - TypeScript strict config
- `old/mcp_gsheet/tsup.config.ts` - Build config
- `old/mcp_gsheet/vitest.config.ts` - Test config
- `old/mcp_gsheet/.eslintrc.json` - Linting rules
- `old/mcp_gsheet/.prettierrc.json` - Code formatting
- `old/mcp_gsheet/.gitignore` - Ignore patterns

## Další kroky

1. **Task 02**: Implementace struktury `src/` a MCP server skeleton
   - Vytvoření adresářů: `src/tools/`, `src/utils/`, `src/types/`, `src/config/`
   - Implementace `src/index.ts` s MCP server boilerplate
   - Tool handler mapping

2. **Task 03**: Konfigurace a setup skripty
   - Vytvoření `scripts/setup-mcp-config.js`
   - `.env.example` a environment variables
   - Dokumentace pro Inspector

## Akceptační kritéria splněna

✅ `npm install` funguje bez chyb (357 balíčků)
✅ `npm run build` úspěšně sestaví projekt
✅ `npm run check` (lint:fix + typecheck) prochází bez chyb
✅ ESLint a Prettier konfigurace převzata z mcp_gsheet
✅ `.gitignore` rozšířena o potřebné cesty
✅ Scripts obsahují `inspector` a `inspector:dev`
✅ Struktura odpovídá task specifikaci
